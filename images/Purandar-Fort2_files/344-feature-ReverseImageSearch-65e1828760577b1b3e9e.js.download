(window.webpackJsonp=window.webpackJsonp||[]).push([[344],{1571:function(e,a,r){"use strict";r.r(a);var t,n,o=r(3),i=r(255),c=r(2),d=r(25),s=r(19),l=(t={},Object(c.a)(t,d.k.video,"videos"),Object(c.a)(t,d.k.image,"images"),t),u=(n={},Object(c.a)(n,d.k.video,s.a.footage.searchRis),Object(c.a)(n,d.k.image,"route/IMAGE/SEARCH_RIS"),n),g={isLoading:!1,isRisDialogOpen:!1,shouldCloseOnDragLeave:!1,uploadError:"",uploadImageSrc:{}},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(a.type){case i.g.CLEAR_UPLOAD_ERROR:return Object(o.a)({},e,{uploadError:""});case i.g.SET_DEFAULT_STATE:return Object(o.a)({},e,g);case i.g.SET_LOADING:return Object(o.a)({},e,{isLoading:!0});case i.g.SET_UPLOAD_ERROR:return Object(o.a)({},e,{uploadError:a.errType});case i.g.SET_UPLOAD_IMAGE_SRC:return Object(o.a)({},e,{uploadImageSrc:a.uploadImageSrc});case i.g.TOGGLE_RIS_DIALOG:return Object(o.a)({},e,{isRisDialogOpen:!e.isRisDialogOpen,shouldCloseOnDragLeave:a.shouldCloseOnDragLeave||!1,uploadError:""});case i.g.UPLOAD_IMAGE_FAILED:return Object(o.a)({},e,{isLoading:!1,uploadError:"generic"});default:return e}},p=r(4),h=r.n(p),m=r(12),f=r(1),b=r(126),O=r(308),D=h.a.mark(N),v=h.a.mark(E);function j(e){return Object.entries(e).reduce((function(e,a){var r=Object(m.a)(a,2),t=r[0],n=r[1];return"content-type"!==t.toLowerCase()&&(e[t]=n),e}),{})}function N(e){var a,r,t,n,o,c;return h.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return a=e.data,s.next=3,Object(f.i)(Object(i.b)());case 3:return s.next=5,Object(f.k)(O.d);case 5:return r=s.sent,t=l[r]||l[d.k.image],s.prev=7,s.next=10,Object(f.c)(d.h,"/".concat(t,"/reverse-image-search"),{method:"POST",body:a,stringifyBody:!1,timeout:1e4,transformHeaders:j});case 10:if(!(n=s.sent).errors){s.next=18;break}return o=Array.isArray(n.errors)?n.errors[0].detail:"unknown",s.next=15,Object(f.c)(b.b.error,"Reverse image search: Studio API upload responded with ".concat(o));case 15:return s.next=17,Object(f.i)(Object(i.i)());case 17:return s.abrupt("return");case 18:return s.next=20,n.map((function(e){return e.id})).join(",");case 20:return c=s.sent,s.next=23,Object(f.i)({type:u[r]||u[d.k.image],payload:{queryString:c}});case 23:s.next=31;break;case 25:return s.prev=25,s.t0=s.catch(7),s.next=29,Object(f.c)(b.b.error,"Reverse image search: Studio API upload failed.  Error details: ",s.t0);case 29:return s.next=31,Object(f.i)(Object(i.i)());case 31:case"end":return s.stop()}}),D,this,[[7,25]])}function E(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.o)(i.g.UPLOAD_IMAGE,N);case 2:case"end":return e.stop()}}),v,this)}var w=r(26),S=r(5),x=r(22),k=r(21),y=r(46),I=r(15),A=r(28),T=r(29),R=r(32),L=r(31),C=r(33),B=r(7),U=r(0),P=r.n(U),G=r(9),F=r.n(G),H=r(36),z=r(38),M=r(3057),J=r(2984),q=r(5013),W=r.n(q),V={upload:"SearchBar_reverse_image_search_upload_Button",cancel:"SearchBar_reverse_image_search_cancel_Button",close:"SearchBar_reverse_image_search_close_Button"},K=function(e){function a(){var e,r;Object(A.a)(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return r=Object(R.a)(this,(e=Object(L.a)(a)).call.apply(e,[this].concat(n))),Object(c.a)(Object(B.a)(Object(B.a)(r)),"handleValidation",(function(e){return Array.from(e).find((function(e){return["image/jpg","image/jpeg","image/png"].includes(e.type)&&e.size<5e6}))})),Object(c.a)(Object(B.a)(Object(B.a)(r)),"handleThumb",(function(e){var a=e.width/e.height,t=Math.round(90*a),n=document.createElement("canvas");n.width=t,n.height=90,n.getContext("2d").drawImage(e,0,0,t,90),r.props.setUploadImageSrc({aspect:a,src:n.toDataURL("image/png",1),thumbWidth:t})})),Object(c.a)(Object(B.a)(Object(B.a)(r)),"handleFiles",(function(e){var a=e.files;if(r.props.clearUploadError(),a.length){var t=r.handleValidation(a);if(t&&"undefined"!=typeof window){var n=new window.FileReader;n.onload=function(){var e=new window.Image;e.onload=function(){r.handleThumb(e)},e.src=n.result},n.readAsDataURL(t);var o=new window.FormData;o.append("image",t),r.props.uploadImage(o)}else r.props.setUploadError(["image/jpg","image/jpeg","image/png"].includes(a[0].type)?"size":"format")}else r.props.setUploadError()})),r}return Object(C.a)(a,e),Object(T.a)(a,[{key:"render",value:function(){var e=this.props,a=e.cancel,r=e.dragAndDrop,t=e.dropAnywhere,n=e.isFloating,o=e.isRisDialogOpen,i=e.orUpload,c=e.showSearchByImageButton,d=e.toggleRisDialog,s=e.uploadError,l=e.risButtonLabel;return P.a.createElement("div",{className:F()(W.a.root)},c&&P.a.createElement(H.a,{size:"large",onClick:d,"data-track-action":"click","data-track-section":"searchBar","data-track-label":"reverseImageSearchButton","data-automation":"SearchBar_reverse_image_search_Button","aria-label":l,className:F()(W.a.button,n&&W.a.isFloating)},P.a.createElement(z.a,{alt:l,value:"search-by-image",theme:{icon:W.a.icon}}),l),d&&P.a.createElement(M.a,Object(I.a)({},this.props,{uploadError:!!s,toggleDialog:d,isDialogOpen:o,processDrop:this.handleFiles,dataTrackSection:"reverseImageSearchDialog",dataAutomation:V}),P.a.createElement(J.a,{upload:i,ctaTitle:r,ctaDragTitle:t,cancel:a,dataTrackSection:"reverseImageSearchDialog",dataAutomation:V,icon:"search-by-image"})))}}]),a}(U.Component);Object(c.a)(K,"defaultProps",{showSearchByImageButton:!0});var Q=K,X=r(5012),Y=Object(S.createSelector)(O.e,(function(e){return e?"search:ris_error_text_".concat(e):"search:ris_error_text_generic"})),Z={clearUploadError:i.a,setUploadError:i.d,setUploadImageSrc:i.e,toggleRisDialog:i.f,uploadImage:i.h},$=Object(w.a)(Object(k.g)(Object(o.a)({},X,y.a)),Object(x.connect)((function(e,a){var r=a.t,t=Object(O.d)(e),n=t!==d.k.image?"_".concat(t):"";return{cancel:r("common:actions_cancel"),close:r("common:actions_close"),dragAndDrop:r("search:ris_drag_and_drop"),dropAnywhere:r("search:ris_drop_anywhere"),isLoading:Object(O.a)(e),isRisDialogOpen:Object(O.b)(e),loadingHelpText:r("search:ris_loading_help_text".concat(n)),orUpload:r("search:ris_or_upload"),shouldCloseOnDragLeave:Object(O.c)(e),supportedHelpText:r("search:ris_supported_help_text"),tooltipText:r("search:ris_tooltip_text".concat(n)),uploadError:Object(O.e)(e),errorText:r(Y(e))}}),Z))(Q);r.d(a,"register",(function(){return ee})),r.d(a,"default",(function(){return $}));var ee=function(e){var a=e.registerReducer,r=e.registerWatchers;a("reverseImageSearch",_),r(E)}},2984:function(e,a,r){"use strict";var t=r(0),n=r.n(t),o=r(36),i=r(38),c=r(9),d=r.n(c),s=r(3074),l=r.n(s),u=function(e){var a=e.upload,r=e.cancel,t=e.ctaTitle,c=e.ctaDragTitle,s=e.isADrag,u=e.toggleDialog,g=e.uploadHandler,_=e.dataTrackSection,p=e.dataAutomation,h=e.icon,m=e.theme,f=n.a.createRef();return n.a.createElement("div",{className:d()(l.a.dddDialogContainer,m.cta)},n.a.createElement(i.a,{className:d()(l.a.dddDialogIcon,m.icon),value:h}),n.a.createElement("div",{className:d()(l.a.dddDialogHelpText,m.ctaTitle,s&&l.a.displayNone)},t),n.a.createElement("div",{className:d()(l.a.dddDialogHelpText,!s&&l.a.displayNone)},c),a&&n.a.createElement(o.a,{size:"small",disabled:s,label:a,className:"",onClick:function(){return f.current.click()},"data-track-action":"click","data-track-section":_,"data-track-label":"upload","data-automation":p.upload}),n.a.createElement("br",null),n.a.createElement("input",{type:"file",accept:".png, .jpg, .jpeg",ref:f,className:d()(l.a.displayNone),onChange:function(e){return g({e:e,files:e.target.files})}}),r&&n.a.createElement(o.a,{size:"small",disabled:s,neutral:!1,label:r,onClick:u,"data-track-action":"click","data-track-section":_,"data-track-label":"cancel","data-automation":p.cancel}))};u.defaultProps={upload:"upload",cancel:null,ctaTitle:"Drag and Drop an Image",ctaDragTitle:"Drop Anywhere",isADrag:!1,toggleDialog:function(){},uploadHandler:function(){},icon:"",dataTrackSection:"",dataAutomation:{upload:"",cancel:""},theme:{}},a.a=u},3057:function(e,a,r){"use strict";(function(e){r.d(a,"a",(function(){return d}));var t=r(10),n=r.n(t),o=r(11),i=r.n(o),c=r(133),d=Object(c.c)("DragDropDialog",(function(){return i()({id:"./DragDropDialog",load:function(){return Promise.all([r.e(329).then(r.bind(null,3085))]).then((function(e){return e[0]}))},path:function(){return n.a.join(e,"./DragDropDialog")},resolve:function(){return 3085},chunkName:function(){return"DragDropDialog"}})}),{loading:null})}).call(this,"/")},3074:function(e,a,r){e.exports={"display-none":"N_a_9b892",displayNone:"N_a_9b892",label:"N_a_4dc52","ddd-dialog":"N_a_84455",dddDialog:"N_a_84455","ddd-dialog-content":"N_a_07ef8",dddDialogContent:"N_a_07ef8","main-content-container":"N_a_bf12c",mainContentContainer:"N_a_bf12c","close-button":"N_a_7e80d",closeButton:"N_a_7e80d","ddd-dialog-drop-area":"N_a_a2ec7",dddDialogDropArea:"N_a_a2ec7","ddd-dialog-drop-mask":"N_a_645c0",dddDialogDropMask:"N_a_645c0","ddd-dialog-pulse":"N_a_e7bc4",dddDialogPulse:"N_a_e7bc4",changePadding:"N_a_46a46","ddd-dialog-border":"N_a_52d3f",dddDialogBorder:"N_a_52d3f","ddd-dialog-close-btn":"N_a_07b59",dddDialogCloseBtn:"N_a_07b59","ddd-dialog-container":"N_a_038d2",dddDialogContainer:"N_a_038d2","ddd-dialog-icon":"N_a_61bf5",dddDialogIcon:"N_a_61bf5","ddd-dialog-help-text":"N_a_3fd6a",dddDialogHelpText:"N_a_3fd6a","ddd-dialog-error-text":"N_a_d5f9d",dddDialogErrorText:"N_a_d5f9d","ddd-dialog-file-requirements":"N_a_93b73 font-body-static-sm",dddDialogFileRequirements:"N_a_93b73 font-body-static-sm"}},308:function(e,a,r){"use strict";r.d(a,"a",(function(){return t})),r.d(a,"b",(function(){return n})),r.d(a,"c",(function(){return o})),r.d(a,"e",(function(){return i})),r.d(a,"f",(function(){return c})),r.d(a,"d",(function(){return d}));var t=function(e){return e.reverseImageSearch.isLoading},n=function(e){return e.reverseImageSearch.isRisDialogOpen},o=function(e){return e.reverseImageSearch.shouldCloseOnDragLeave},i=function(e){return e.reverseImageSearch.uploadError},c=function(e){var a;return null===(a=e.reverseImageSearch)||void 0===a?void 0:a.uploadImageSrc},d=function(e){return e.location.siteIdentifier}},5012:function(e){e.exports=JSON.parse('{"search:ris_drag_and_drop":"Drag and drop an image to find similar","search:ris_drop_anywhere":"Drop anywhere to find similar","search:ris_error_text_generic":"Something went wrong! Please try again.","search:ris_error_text_format":"Something went wrong! Check the file format and try again.","search:ris_error_text_size":"Something went wrong! Check the file size and try again.","search:ris_loading_help_text":"Finding similar images","search:ris_loading_help_text_video":"Finding similar videos","search:ris_or_upload":"Or, upload","search:ris_supported_help_text":"We only support JPG and PNG images under 5MB.","search:ris_tooltip_text":"Search with an image instead of text to discover similar images.","search:ris_tooltip_text_video":"Search with an image instead of text to discover similar videos."}')},5013:function(e,a,r){e.exports={root:"G_a_63359",button:"G_a_b4b4c","is-floating":"G_a_2354f",isFloating:"G_a_2354f",icon:"G_a_4560b"}}}]);
//# sourceMappingURL=344-feature-ReverseImageSearch-65e1828760577b1b3e9e.js.map